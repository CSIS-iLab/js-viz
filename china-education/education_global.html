<!DOCTYPE HTML>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>China Global Education Comparison</title>

		<link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>

		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		  <script src="https://code.highcharts.com/maps/highmaps.js"></script>
		<script src="https://code.highcharts.com/maps/modules/data.js"></script>
		<script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
		<script src="cn-all.js"></script>



		<style type="text/css">

			#container {
				height: 500px;
				min-width: 310px;
				max-width: 800px;
				margin: 0 auto;
			}
			.loading {
				margin-top: 10em;
				text-align: center;
				color: gray;
			}

		</style>

	</head>

<body>

	<script>

	$(function () {

		var description; // Initialize indicator description variable. Will be populated when chart renders
		var currentIndicator = 'education';

		// Object associated text with indicators
		var indicatorsObj = {
			education: {
				buttonText: "Education Index",
				buttonY: 140,
			},
	      	literacy: {
				buttonText: "Literacy Rate",
				buttonY: 180,
			},
	      	primary: {
				buttonText: "Primary Ratio",
				buttonY: 220,
			},
	      	secondary: {
				buttonText: "Secondary Ratio",
				buttonY: 260,
			},
	      	tertiary: {
				buttonText: "Tertiary Ratio",
				buttonY: 300,
			},
		};

		var options = {
			data: {
				googleSpreadsheetKey: '1wjo9UVjnL2N22ukdwI5B4CC4RKLEbW3fqWNNCx-no_0',
				googleSpreadsheetWorksheet: 1,


			    // custom handler when the spreadsheet is parsed
			    parsed: function(columns) {

					// Read the columns into the data array
					var data = {
						education: [],
						literacy: [],
						primary: [],
						secondary: [],
						tertiary: []
					};
				    columns[0].forEach(function(code, i) {
				      	if (i != 0) {
				      		data.education.push({
				      			code: columns[1][i].toUpperCase(),
				      			value: parseFloat(columns[2][i]),
				      			name: columns[0][i],
				      			countryMatch: columns[3][i]
				      		});

				      		data.literacy.push({
				      			code: columns[1][i].toUpperCase(),
				      			name: columns[0][i],
				      			value: parseFloat(columns[4][i]),
				      			countryMatch: columns[5][i]
				      		});

				      		data.primary.push({
				      			code: columns[1][i].toUpperCase(),
				      			name: columns[0][i],
				      			value: parseFloat(columns[6][i]),
				      			countryMatch: columns[7][i]
				      		});

				      		data.secondary.push({
				      			code: columns[1][i].toUpperCase(),
				      			name: columns[0][i],
				      			value: parseFloat(columns[8][i]),
				      			countryMatch: columns[9][i]
				      		});

				      		data.tertiary.push({
				      			code: columns[1][i].toUpperCase(),
				      			name: columns[0][i],
				      			value: parseFloat(columns[10][i]),
				      			countryMatch: columns[11][i]
				      		});
				      	}
				    });
			      	dataObj = data;
				}
			},

			chart: {
				borderWidth: 1,
				events: {
					load: function() {
						this.series[0].setData(dataObj.education);
					}
				}
			},

			colors: ['rgba(19,64,117,0.05)', 'rgba(19,64,117,0.2)', 'rgba(19,64,117,0.4)',
			'rgba(19,64,117,0.5)', 'rgba(19,64,117,0.6)', 'rgba(19,64,117,0.8)', 'rgba(19,64,117,1)'
			],
			  //title of map
			  title: {
			  	text: 'China - Global Education Indicators Comparison',
			  	margin: 50,
			  },

			  // +/- zoom
			  mapNavigation: {
			  	enabled: true
			  },

			  credits: {
			  	enabled: true,
			  	href: "http://csis.org",
			  	text: 'CSIS China Power Project'
			  },

			  legend: {
			  	title: {
			  		text: indicatorsObj[currentIndicator].buttonText,
			  		style: {
			  			fontStyle: 'italic'
			  		}

			  	},
			  	align: 'left',
			  	verticalAlign: 'bottom',
			  	floating: true,
			  	layout: 'horizontal',
			  	valueDecimals: 0,
			  	symbolRadius: 0,
			  	symbolHeight: 15
			  },

			  colorAxis: {
			  	minColor: "#59a992",
                maxColor: "#000000",
			  	labels: {
			  		enabled: true,
			  		formatter: function() {
			  			return this.value
			  		}
			  	},
			},

			tooltip: {
				formatter: function() {
					return `<strong>${this.key}</strong><br />
					<strong>${indicatorsObj[currentIndicator].buttonText}:</strong> ${this.point.value}<br />
					<strong>Country Match:</strong> ${this.point.countryMatch}`;
				}
			},

			series: [{
			    mapData: Highcharts.maps['countries/cn/cn-all'],
			    joinBy: ['hc-a2', 'code'],
			    animation: true,
			    nullColor: '#4E6D78',
			    name: 'GDP Growth Rate',
			    states: {
			    	hover: {
			    		color: '#ED392A'
			    	}
			    },
			    tooltip: {
			    	valueDecimals: 2,
			    	valueSuffix: '%'
			    }
			}]
		};

		function renderButtons() {
			// Render initial text
			description = chart.renderer.text(indicatorsObj[currentIndicator].buttonText, 400, 60).attr({'id': "description"}).add();

			// Render Buttons
			$.each(indicatorsObj, function(key, value) {
				chart.renderer.button(value.buttonText, 9, value.buttonY, function() {
					switchData(key);
				},null,null,null).add();
			});

		}

		// Initiate the chart
		var chart = Highcharts.Map('container', options, renderButtons);


        // Switch between datasets
        function switchData(indicator) {
        	currentIndicator = indicator; // Update the current Indicator
        	chart.series[0].setData(dataObj[indicator]); // Update the series data
           	description.attr({text: indicator}); // Update the description text
            chart.legend.title.attr({ text: indicatorsObj[currentIndicator].buttonText }); // Update the legend text
        }

	});


	</script>


	<div id="container" style="max-width: 1000px"></div>



</body>

</html>
